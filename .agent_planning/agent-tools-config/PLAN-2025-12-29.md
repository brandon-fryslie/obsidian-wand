# Sprint Plan: Agent Configuration & Comparison

**Generated**: 2025-12-29
**Sprint Goal**: Enable per-agent tool sets, per-agent LLM config, and parallel agent comparison

---

## Work Items

### P0-1: Per-Agent Tool Sets

**Effort**: 3-4 days

Currently `ToolsLayer` is monolithic - all 40+ tools available to all agents. Extract to allow agents to declare their tool requirements.

**Design:**
```typescript
// In Agent interface
interface Agent {
  // ... existing methods
  getRequiredTools(): ToolName[];  // Tools this agent needs
}

// WandAgent declares all tools
getRequiredTools(): ToolName[] {
  return [...READ_ONLY_TOOLS, ...SAFE_WRITE_TOOLS, ...DANGEROUS_TOOLS];
}

// Future ResearchAgent only needs read tools
getRequiredTools(): ToolName[] {
  return ['vault.readFile', 'vault.listFiles', 'vault.searchText', 'dataview.query'];
}
```

**Changes:**
- Add `getRequiredTools()` to Agent interface
- WandAgent returns full tool set
- AgentDependencies passes filtered ToolsLayer or tool list
- System prompt only includes tools the agent can use

**Acceptance Criteria:**
- [ ] Agent interface has `getRequiredTools()` method
- [ ] WandAgent declares its required tools
- [ ] System prompt only shows agent's available tools
- [ ] Executor respects tool restrictions

---

### P0-2: Per-Agent LLM Configuration

**Effort**: 2-3 days

Allow agents to override global LLM settings.

**Settings structure:**
```typescript
interface ToolAgentSettings {
  agent: {
    type: AgentType;
    // Per-agent overrides (optional)
    overrides?: {
      [agentType: string]: {
        llm?: {
          provider?: LLMProvider;
          model?: string;
          temperature?: number;
        };
      };
    };
  };
  llm: { ... };  // Global defaults
}
```

**Design:**
- Agent receives merged config (global + overrides)
- If no override, use global
- Settings UI shows per-agent config section when agent selected

**Changes:**
- Update settings.ts with per-agent override structure
- AgentDependencies includes merged LLM config
- WandAgent uses its specific config
- Settings UI has collapsible per-agent section

**Acceptance Criteria:**
- [ ] Settings support per-agent LLM overrides
- [ ] Agent receives merged configuration
- [ ] UI allows configuring per-agent settings
- [ ] Default behavior unchanged (inherit global)

---

### P0-3: Parallel Agent Comparison Mode

**Effort**: 4-5 days

Run same message through multiple agents, compare outputs side-by-side.

**Design:**
```typescript
// New comparison controller
class ComparisonController {
  async compare(message: string, agentTypes: AgentType[]): Promise<ComparisonResult> {
    const results = await Promise.all(
      agentTypes.map(type => this.runAgent(type, message))
    );
    return { message, results };
  }
}

interface ComparisonResult {
  message: string;
  results: Array<{
    agentType: AgentType;
    response: AgentResponse;
    duration: number;
  }>;
}
```

**UI:**
- New "Compare" button or mode toggle
- Side-by-side plan display
- Select which plan to execute
- Show timing/token differences

**Changes:**
- New ComparisonController service
- UI component for side-by-side display
- Settings option to enable comparison mode
- Ability to spawn multiple agent instances

**Acceptance Criteria:**
- [ ] Can run same message through 2+ agents
- [ ] Results displayed side-by-side
- [ ] User can select which plan to execute
- [ ] Shows timing comparison
- [ ] Works with different agent types

---

## Dependency Order

```
P0-1 (Tools per agent)
  └─> P0-2 (LLM per agent) - can be parallel
        └─> P0-3 (Comparison mode) - needs both
```

P0-1 and P0-2 can be done in parallel. P0-3 depends on having configurable agents.

---

## Files to Create/Modify

**New:**
- `src/services/ComparisonController.ts`
- `src/components/ComparisonView.svelte`

**Modified:**
- `src/agents/Agent.ts` - Add `getRequiredTools()`
- `src/agents/WandAgent.ts` - Implement tool declaration
- `src/types/settings.ts` - Per-agent config structure
- `src/services/PluginServices.ts` - Support multiple agent instances
- `src/main.ts` - Settings UI for per-agent config
- `src/components/ChatPanel.svelte` - Comparison mode UI

---

## Definition of Done

**Sprint complete when:**
1. [ ] Agents declare their required tools
2. [ ] System prompts only show agent's tools
3. [ ] Per-agent LLM settings configurable
4. [ ] Comparison mode runs multiple agents
5. [ ] Side-by-side plan display works
6. [ ] User can select and execute preferred plan
7. [ ] Tests pass, TypeScript compiles, build succeeds
