# Definition of Done: Claude Code Integration via MCP Server
**Generated**: 2025-12-31-015433
**Plan**: PLAN-2025-12-31-015433.md
**Source STATUS**: STATUS-20251231-014500.md

---

## Sprint Scope
This sprint delivers: **WebSocket MCP transport + Connection UI + Claude Code validation**

Deferred to Sprint 2: Auto-discovery, cross-platform validation, documentation polish

---

## Acceptance Criteria

### P0-1: Add WebSocket Transport to ObsidianMCPServer

#### MCP Protocol Implementation
- [ ] WebSocket server starts when plugin loads and ObsidianMCPServer is configured
- [ ] Server listens on configurable port (default 22360, stored in plugin settings)
- [ ] MCP protocol implemented: handles `tools/list` request and returns all 38+ tools
- [ ] MCP protocol implemented: handles `tools/call` request and routes to existing tool handlers
- [ ] Error responses follow MCP JSON-RPC error format
- [ ] Server gracefully shuts down when plugin unloads

#### Testing & Validation
- [ ] Unit tests verify MCP message parsing and routing
- [ ] Integration test: Connect with WebSocket client and call vault_readFile tool

---

### P1-1: Add Connection Management UI in Settings

#### Settings Configuration
- [ ] Settings section "Claude Code Integration (MCP Server)" added to plugin settings
- [ ] Toggle to enable/disable MCP server (default: enabled)
- [ ] Number input for port configuration (default: 22360, range: 1024-65535)
- [ ] Read-only status display shows: "Server running on port 22360" or "Server stopped"
- [ ] Active connection count displayed (e.g., "1 client connected")

#### Dynamic Configuration
- [ ] Port change takes effect immediately (restart server without plugin reload)
- [ ] Error handling: If port in use, display error and suggest alternative port
- [ ] Settings UI follows Obsidian plugin design patterns (consistent styling)

---

### P1-2: Test with Claude Code CLI

#### Installation & Discovery
- [ ] Claude Code CLI installed: `npm install -g @anthropic-ai/claude-code`
- [ ] Claude Code discovers Obsidian MCP server (via manual config or auto-discovery)
- [ ] Tool discovery works: `claude` shows Obsidian tools in available tools list

#### Tool Execution Validation
- [ ] File operations tested: vault_readFile, vault_writeFile, vault_createFile work correctly
- [ ] Search operations tested: vault_searchText, vault_listFiles return valid results
- [ ] Editor operations tested: editor_insertAtCursor, workspace_openFile work when file is open
- [ ] Plugin integrations tested: dataview_query, tasks_createTask work (if plugins installed)

#### Error Handling & Performance
- [ ] Error handling tested: Invalid paths return proper error messages to Claude Code
- [ ] Streaming responses: Claude Code receives and displays tool results correctly
- [ ] Cross-platform tested: Works on macOS (primary), Windows validation recommended

---

### P2-1: Add Service Discovery/Announcement

#### Discovery Implementation
- [ ] mDNS/DNS-SD announcement broadcasts MCP server availability on local network
- [ ] Service advertised as `_mcp._tcp.local` with name `obsidian-vault`
- [ ] TXT records include: port, vault name, plugin version
- [ ] Claude Code auto-discovers server (if Claude Code supports discovery)

#### Fallback Configuration
- [ ] Fallback: Generate `.mcp.json` config snippet in settings UI for manual setup
- [ ] Discovery can be disabled in settings (privacy consideration)

---

### P2-2: Cross-Platform Validation & Documentation

#### Platform Testing
- [ ] Windows testing: MCP server starts, Claude Code connects, tools work
- [ ] Linux testing: Works on standard install (not Flatpak/Snap initially)
- [ ] macOS testing: Already validated via primary development

#### Documentation
- [ ] Documentation: README section "Connecting Claude Code via MCP" created
- [ ] Documentation: Installation guide (install Claude Code, configure MCP, test connection)
- [ ] Documentation: Troubleshooting section (port conflicts, PATH issues, firewall)
- [ ] Documentation: Example workflows (create notes, search vault, plugin integrations)
- [ ] CLAUDE.md updated: Add MCP server architecture section
- [ ] Video/GIF: Optional screen recording showing setup flow (30 seconds)

---

## Sprint 1 Definition of Done

**Core Deliverables** (P0 + P1):
1. MCP server running on localhost:22360 with WebSocket transport
2. Settings UI for enable/disable and port configuration
3. Validated with real Claude Code CLI
4. All 38+ tools working via external connection

**Success Criteria**:
- User can run `claude -s obsidian-vault` and interact with Obsidian vault
- Zero critical bugs in core tool execution
- Settings UI provides clear status feedback

**Ready for**: Public beta testing with Claude Code users

---

## Sprint 2 Definition of Done

**Enhanced UX** (P2):
1. Auto-discovery OR config snippet generation for easy setup
2. Comprehensive documentation with troubleshooting guide
3. Cross-platform validation (Windows/Linux/macOS)

**Success Criteria**:
- New user can set up in <5 minutes following docs
- Documentation reviewed and validated
- Works on all three major platforms

**Ready for**: Production release and community plugin submission

---

## Production Readiness Checklist

- [ ] All P0 and P1 items completed
- [ ] Integration tests pass (automated where possible)
- [ ] Manual testing on 3 platforms (Win/Mac/Linux)
- [ ] Documentation reviewed by another developer
- [ ] Error messages are user-friendly (not stack traces)
- [ ] Performance: Tool calls complete in <500ms for simple operations
- [ ] No memory leaks (test with 100+ consecutive tool calls)
- [ ] MCP Inspector shows all tools with correct schemas
- [ ] User feedback: "Easy to set up"

---

**END OF DEFINITION OF DONE**
